generator client {
  provider = "prisma-client-js"
  output   = "../lib/generated/prisma"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model users {
  id              String            @id @db.Uuid
  encrypted_phone String
  hashed_phone    String
  pin             String?
  email           String?           @unique
  name            String?
  role            Int               @default(1)
  metadata        Json?
  created_at      DateTime          @default(dbgenerated("(now() AT TIME ZONE 'utc'::text)")) @db.Timestamptz(6)
  updated_at      DateTime          @default(dbgenerated("(now() AT TIME ZONE 'utc'::text)")) @updatedAt @db.Timestamptz(6)
  calendar_events calendar_events[]
  collections     collections[]
  feedbacks       feedbacks[]
  memories        memories[]
  reminders       reminders[]
  tasks           tasks[]

  @@index([email])
  @@map("users")
}

model feedbacks {
  id          Int      @id @default(autoincrement())
  user_id     String   @db.Uuid
  title       String
  description String?
  tag         String
  created_at  DateTime @default(now()) @db.Timestamptz(6)
  updated_at  DateTime @updatedAt @db.Timestamptz(6)
  user        users    @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id])
  @@index([tag])
  @@map("feedbacks")
}

model memories {
  id         Int      @id @default(autoincrement())
  user_id    String   @db.Uuid
  title      String?
  content    String
  created_at DateTime @default(now()) @db.Timestamptz(6)
  updated_at DateTime @updatedAt @db.Timestamptz(6)
  user       users    @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id])
  @@map("memories")
}

model calendar_events {
  id                    Int                    @id @default(autoincrement())
  user_id               String                 @db.Uuid
  title                 String
  description           String?
  start_time            DateTime               @db.Timestamptz(6)
  end_time              DateTime               @db.Timestamptz(6)
  timezone              String
  is_all_day            Boolean                @default(false)
  created_at            DateTime               @default(now()) @db.Timestamptz(6)
  updated_at            DateTime               @updatedAt @db.Timestamptz(6)
  calendar_event_google calendar_event_google?
  user                  users                  @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id])
  @@index([start_time])
  @@index([end_time])
  @@map("calendar_events")
}

model calendar_event_google {
  id                 Int             @id @default(autoincrement())
  event_id           Int             @unique
  event_id_str       String
  google_calendar_id String
  raw_google_data    Json
  google_event_id    String
  created_at         DateTime        @default(now()) @db.Timestamptz(6)
  updated_at         DateTime        @updatedAt @db.Timestamptz(6)
  calendar_event     calendar_events @relation(fields: [event_id], references: [id], onDelete: Cascade)

  @@index([google_event_id])
  @@map("calendar_event_google")
}

model tasks {
  id            Int          @id @default(autoincrement())
  user_id       String       @db.Uuid
  collection_id Int?
  title         String
  description   String?
  status        String
  created_at    DateTime     @default(now()) @db.Timestamptz(6)
  updated_at    DateTime     @updatedAt @db.Timestamptz(6)
  collection    collections? @relation(fields: [collection_id], references: [id])
  user          users        @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id])
  @@index([collection_id])
  @@index([status])
  @@map("tasks")
}

model collections {
  id                 Int                  @id @default(autoincrement())
  user_id            String               @db.Uuid
  shared_token       String?
  title              String
  created_at         DateTime             @default(now()) @db.Timestamptz(6)
  updated_at         DateTime             @updatedAt @db.Timestamptz(6)
  collection_members collection_members[]
  user               users                @relation(fields: [user_id], references: [id], onDelete: Cascade)
  tasks              tasks[]

  @@index([user_id])
  @@index([shared_token])
  @@map("collections")
}

model collection_members {
  id            Int         @id @default(autoincrement())
  collection_id Int
  user_id       String      @db.Uuid
  role          String
  created_at    DateTime    @default(now()) @db.Timestamptz(6)
  updated_at    DateTime    @updatedAt @db.Timestamptz(6)
  collection    collections @relation(fields: [collection_id], references: [id], onDelete: Cascade)

  @@unique([collection_id, user_id])
  @@index([collection_id])
  @@index([user_id])
  @@map("collection_members")
}

model reminders {
  id            Int      @id @default(autoincrement())
  user_id       String   @db.Uuid
  message       String
  reminder_time DateTime @db.Timestamptz(6)
  status        String
  created_at    DateTime @default(now()) @db.Timestamptz(6)
  updated_at    DateTime @updatedAt @db.Timestamptz(6)
  user          users    @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id])
  @@index([reminder_time])
  @@index([status])
  @@map("reminders")
}
